$(document).ready(function(){$("#btn-result").removeClass("disabled");var b=$("#domain").data("domain");window.fbAsyncInit=function(){FB.init({appId:"<?php echo $_SESSION['fb_access_token']; ?>",cookie:!0,autoLogAppEvents:!0,xfbml:!0,version:"v2.12"}),FB.Event.subscribe("messenger_checkbox",function(c){if(console.log("messenger_checkbox event"),console.log(c),"rendered"==c.event)console.log("Plugin was rendered");else if("checkbox"==c.event){var d=c.state;console.log("Checkbox state: "+d)}else"not_you"==c.event?console.log("User clicked 'not you'"):"hidden"==c.event&&console.log("Plugin was hidden")}),FB.getLoginStatus(function(c){"connected"===c.status?(console.log("is_connected"),FB.api("/me",{locale:"fr_FR",fields:"id,first_name,last_name,link,gender,locale"},function(d){$.ajax({url:b+"/setsession",type:"POST",data:"id="+d.id+"&first_name="+d.first_name+"&last_name="+d.last_name+"&gender="+d.gender,beforeSend:function(){console.log("sending..."),$("#btn-result").addClass("disabled")}}).done(function(f){console.log(f),$("#btn-result").removeClass("disabled")})})):console.log("not_connected")})},openModalDiscovery(),openModalShare(),$("#btn-show-discover-block").click(function(){$("html, body").animate({scrollTop:$("#discover-section").offset().top},800)}),$(".btn_to_track").on("click",function(){}),$("#btn-result").on("click",function(){$(this).removeClass("disabled"),console.log("Test en cours")}),$("#additionnal_input_text").keypress(function(c){var d=$("#additionnal_input_text").val(),f=d.length+1,g=c.which;return 13===g&&1<=f?($("#btn-result").click(),!1):void(console.log(f),1<=f?$("#btn-result").fadeIn("fast"):$("#btn-result").fadeOut("fast"))}),$(".modal").on("shown.bs.modal",alignModal),$(window).on("resize",function(){$(".modal:visible").each(alignModal)})});function alignModal(){var a=$(this).find(".modal-dialog");a.css("margin-top",Math.max(0,($(window).height()-a.height())/2))}function setSessionVar(a,b,c,d=!1){!0==d&&loader(),$.ajax({url:domain+"/setSessionVar",type:"post",data:{varName:a,value:b},success:function(){window.location.replace(domain+"/start/"+c)},error:function(){}})}function setSessionVarCDM(a,b,c,d,f=!1){!0==f&&loader(),$.ajax({url:domain+"/setSessionVarCDM",type:"post",data:{varName:a,countryCode:b,countryName:c},success:function(){window.location.replace(domain+"/start/"+d)},error:function(){}})}function changeLang(a){var b=$("#domain").data("resquest-uri"),c=$("#domain").data("defined-domain");0<=b.indexOf("?")?window.location.replace("https://"+a+"."+c+b+"&utm_source=funizi&utm_medium=select&utm_campaign=select_lang"):window.location.replace("https://"+a+"."+c+b+"?utm_source=funizi&utm_medium=select&utm_campaign=select_lang")}function partage(a,b,c){$.ajax({url:domain+"/share/"+c+"/"+b,type:"post",data:{code:a},success:function(d){console.log(d)},error:function(d){console.log(d)}})}function partageCitation(a,b,c){$.ajax({url:domain+"/shareCitation/"+c+"/"+b,type:"post",data:{code:a},success:function(d){console.log(d)},error:function(d){console.log(d)}})}function partageStory(a,b,c){$.ajax({url:domain+"/shareStory/"+c+"/"+b,type:"post",data:{code:a},success:function(d){console.log(d)},error:function(d){console.log(d)}})}function openModal(a){var b=$("#facebook-login-modal");$("#btn_log_fb").attr("onClick","seConnecterFacebook("+a+", "+0+")"),b.modal("show")}function openModalDiscovery(){0<$("#discovery-tests-modal").length&&$("#discovery-tests-modal").modal("show")}function openModalShare(){0<$("#discovery-share-modal").length&&setTimeout(function(){$("#discovery-share-modal").modal("show")},8e3)}function clickButton(a){console.log("Bonton <<"+a+">> cliqu\xE9"),$.ajax({url:domain+"/click/"+a,type:"get",cache:!1,beforeSend:function(){console.log(a)}}).done(function(b){console.log(b)})}$(".cta ").click(function(){$(".cta:not(.sent)").addClass("active"),$(".inputsubnewsletter > input").focus()});var regex=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;$(".inputsubnewsletter > input").on("input",function(){regex.test($(this).val())?$(".buttonsubnewsletter > button").removeAttr("disabled"):$(".buttonsubnewsletter > button").attr("disabled","disabled")}),$("form").submit(function(a){a.preventDefault(),regex.test($(".inputsubnewsletter > input").val())&&(email=$(".inputsubnewsletter > input").val(),$.ajax({url:domain+"/save-subscription-to-newsletter",type:"post",cache:!1,data:{email:email},beforeSend:function(){thank=$("#sign_up_newsletter_thank").val(),$(".cta span").text(thank),$(".cta").removeClass("active").addClass("sent"),console.log(thank)}}).done(function(b){console.log(b)}))}),window.fbAsyncInit=function(){FB.init({appId:"<?php echo $_SESSION['fb_access_token']; ?>",autoLogAppEvents:!0,xfbml:!0,version:"v2.12",status:!0,cookie:!0,oauth:!0}),FB.AppEvents.logPageView()};var domain=$("#domain").data("domain");function seConnecterFacebook(a,b){var c="public_profile";1===b&&(c="public_profile, user_friends, user_posts, user_photos"),FB.login(function(d){d.authResponse?getFbUserData(a,b):console.log("denied")},{scope:c,auth_type:"rerequest"})}function getFbUserData(a,b){1===b?FB.api("/me/permissions ",function(c){var d=!0,f="";for(i=0;i<c.data.length;i++)("user_friends"===c.data[i].permission||"user_photos"===c.data[i].permission||"user_posts"===c.data[i].permission)&&"declined"===c.data[i].status&&(d=!1);d?($(".modal-body").html(" <p>Veuillez vous connecter via Facebook pour cr\xE9er votre propre test !<br>Simple ! Gratuit ! S\xE9curis\xE9 !</p>"),FB.api("/me/friends",{locale:"fr_FR",fields:"id,first_name,last_name,gender"},function(g){var h=JSON.stringify(g.data);f+="&friends="+h,FB.api("/me/posts",{locale:"fr_FR",fields:"reactions{id,name}"},function(j){var k=JSON.stringify(j.data);f+="&posts="+k,FB.api("/me/photos",{locale:"fr_FR",fields:"from{id,name}"},function(l){var m=JSON.stringify(l.data);f+="&photos="+m,console.log(f),FB.api("/me",{locale:"fr_FR",fields:"id,first_name,last_name,gender"},function(o){return $.ajax({url:domain+"/connect_user",type:"POST",data:"id="+o.id+"&prenom="+o.first_name+"&nom="+o.last_name+"&genre="+o.gender+f,beforeSend:function(){loader()}}).done(function(p){console.log(p),""!==p&&window.location.replace(domain+"/start/"+a)}),!1})})})})):($(".modal-body").html(" <p>Veuillez vous connecter via Facebook pour cr\xE9er votre propre test !<br>Simple ! Gratuit ! S\xE9curis\xE9 !</p><p style='font-weight:700'> Les autorisations suivantes sont n\xE9cessaires pour effectuer  ce test : <br> Liste d'amis, Publications, Photos </p><p style='font-weight:800'> Vous devez accorder les autorisations pour continuer."),$("#div_erreur_aut").fadeIn("slow").css("display","block"),setTimeout(function(){$("#div_erreur_aut").fadeOut()},7e3))}):(console.log(b),FB.api("/me",{locale:"fr_FR",fields:"id,first_name,last_name,gender"},function(c){return $.ajax({url:domain+"/connect_user",type:"POST",data:"id="+c.id+"&prenom="+c.first_name+"&nom="+c.last_name+"&genre="+c.gender,beforeSend:function(){}}).done(function(d){console.log(d),""!==d&&window.location.replace(domain+"/start/"+a)}),!1}))}var task=0;loader=function(){$("#btn-result").prop("disabled",!0),$("#div_test").css("display","none"),$("#div_loader").css("display","block"),$("html, body").animate({scrollTop:0},600),setInterval(function(){task>=tasks.length&&(task=0),$("#div_tasks").html(tasks[task++])},700)},loaderReTest=function(){$("#result_block").css("display","none"),$("#div_loader").css("display","block"),$("html, body").animate({scrollTop:0},600),setInterval(function(){task>=tasks.length&&(task=0),$("#div_tasks").html(tasks[task++])},700)},notLoader=function(){$("#btn-result").html("<i class=\"fa fa-facebook-square\"></i>  Connecte-toi sur Facebook"),$("#div_test").fadeIn("fast"),$("#div_loader").fadeOut("fast")};
