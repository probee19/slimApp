function alignModal(){var e=$(this).find(".modal-dialog");e.css("margin-top",Math.max(0,($(window).height()-e.height())/2))}function setSessionVar(e,o,n,t){1==(t=t||!1)&&loader(),$.ajax({url:domain+"/setSessionVar",type:"post",data:{varName:e,value:o},success:function(e){window.location.replace(domain+"/start/"+n)},error:function(e){}})}function setSessionVarCDM(e,o,n,t,a){1==(a=a||!1)&&loader(),$.ajax({url:domain+"/setSessionVarCDM",type:"post",data:{varName:e,countryCode:o,countryName:n},success:function(e){window.location.replace(domain+"/start/"+t)},error:function(e){}})}function changeLang(e){var o=$("#domain").data("resquest-uri"),n=$("#domain").data("defined-domain");0<=o.indexOf("?")?window.location.replace("https://"+e+"."+n+o+"&utm_source=funizi&utm_medium=select&utm_campaign=select_lang"):window.location.replace("https://"+e+"."+n+o+"?utm_source=funizi&utm_medium=select&utm_campaign=select_lang")}function partage(e,o,n){$.ajax({url:domain+"/share/"+n+"/"+o,type:"post",data:{code:e},success:function(e){console.log(e)},error:function(e){console.log(e)}})}function partageCitation(e,o,n){$.ajax({url:domain+"/shareCitation/"+n+"/"+o,type:"post",data:{code:e},success:function(e){console.log(e)},error:function(e){console.log(e)}})}function openModal(e){var o=$("#facebook-login-modal");$("#btn_log_fb").attr("onClick","seConnecterFacebook("+e+", 0)"),o.modal("show")}function openModalDiscovery(){0<$("#discovery-tests-modal").length&&$("#discovery-tests-modal").modal("show")}function openModalShare(){0<$("#discovery-share-modal").length&&setTimeout(function(){$("#discovery-share-modal").modal("show")},8e3)}function clickButton(e){console.log("Bonton <<"+e+">> cliqué"),$.ajax({url:domain+"/click/"+e,type:"get",cache:!1,beforeSend:function(){console.log(e)}}).done(function(e){console.log(e)})}$(document).ready(function(){$("#btn-result").removeClass("disabled");var o=$("#domain").data("domain");window.fbAsyncInit=function(){FB.init({appId:"<?php echo $_SESSION['fb_access_token']; ?>",cookie:!0,autoLogAppEvents:!0,xfbml:!0,version:"v2.12"}),FB.Event.subscribe("messenger_checkbox",function(e){if(console.log("messenger_checkbox event"),console.log(e),"rendered"==e.event)console.log("Plugin was rendered");else if("checkbox"==e.event){var o=e.state;console.log("Checkbox state: "+o)}else"not_you"==e.event?console.log("User clicked 'not you'"):"hidden"==e.event&&console.log("Plugin was hidden")}),FB.getLoginStatus(function(e){"connected"===e.status?(console.log("is_connected"),FB.api("/me",{locale:"fr_FR",fields:"id,first_name,last_name,link,gender,locale"},function(e){$.ajax({url:o+"/setsession",type:"POST",data:"id="+e.id+"&first_name="+e.first_name+"&last_name="+e.last_name+"&gender="+e.gender,beforeSend:function(){console.log("sending..."),$("#btn-result").addClass("disabled")}}).done(function(e){console.log(e),$("#btn-result").removeClass("disabled")})})):console.log("not_connected")})},openModalDiscovery(),openModalShare(),$("#btn-show-discover-block").click(function(){$("html, body").animate({scrollTop:$("#discover-section").offset().top},800)}),$(".btn_to_track").on("click",function(){}),$("#btn-result").on("click",function(e){$(this).removeClass("disabled"),console.log("Test en cours")}),$("#additionnal_input_text").keypress(function(e){var o=$("#additionnal_input_text").val().length+1;if(13===e.which&&1<=o)return $("#btn-result").click(),!1;console.log(o),1<=o?$("#btn-result").fadeIn("fast"):$("#btn-result").fadeOut("fast")}),$(".modal").on("shown.bs.modal",alignModal),$(window).on("resize",function(){$(".modal:visible").each(alignModal)})}),$(".cta ").click(function(){$(".cta:not(.sent)").addClass("active"),$(".inputsubnewsletter > input").focus()});var regex=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;$(".inputsubnewsletter > input").on("input",function(){regex.test($(this).val())?$(".buttonsubnewsletter > button").removeAttr("disabled"):$(".buttonsubnewsletter > button").attr("disabled","disabled")}),$("form").submit(function(e){e.preventDefault(),regex.test($(".inputsubnewsletter > input").val())&&(email=$(".inputsubnewsletter > input").val(),$.ajax({url:domain+"/save-subscription-to-newsletter",type:"post",cache:!1,data:{email:email},beforeSend:function(){thank=$("#sign_up_newsletter_thank").val(),$(".cta span").text(thank),$(".cta").removeClass("active").addClass("sent"),console.log(thank)}}).done(function(e){console.log(e)}))}),window.fbAsyncInit=function(){FB.init({appId:"<?php echo $_SESSION['fb_access_token']; ?>",autoLogAppEvents:!0,xfbml:!0,version:"v2.12",status:!0,cookie:!0,oauth:!0}),FB.AppEvents.logPageView()};var domain=$("#domain").data("domain");function seConnecterFacebook(o,n){var e="public_profile";1===n&&(e="public_profile, user_friends, user_posts, user_photos"),FB.login(function(e){e.authResponse?getFbUserData(o,n):console.log("denied")},{scope:e,auth_type:"rerequest"})}function getFbUserData(t,e){1===e?FB.api("/me/permissions ",function(e){var o=!0,n="";for(i=0;i<e.data.length;i++)"user_friends"!==e.data[i].permission&&"user_photos"!==e.data[i].permission&&"user_posts"!==e.data[i].permission||"declined"!==e.data[i].status||(o=!1);o?($(".modal-body").html(" <p>Veuillez vous connecter via Facebook pour créer votre propre test !<br>Simple ! Gratuit ! Sécurisé !</p>"),FB.api("/me/friends",{locale:"fr_FR",fields:"id,first_name,last_name,gender"},function(e){var o=JSON.stringify(e.data);n+="&friends="+o,FB.api("/me/posts",{locale:"fr_FR",fields:"reactions{id,name}"},function(e){var o=JSON.stringify(e.data);n+="&posts="+o,FB.api("/me/photos",{locale:"fr_FR",fields:"from{id,name}"},function(e){var o=JSON.stringify(e.data);n+="&photos="+o,console.log(n),FB.api("/me",{locale:"fr_FR",fields:"id,first_name,last_name,gender"},function(e){return $.ajax({url:domain+"/connect_user",type:"POST",data:"id="+e.id+"&prenom="+e.first_name+"&nom="+e.last_name+"&genre="+e.gender+n,beforeSend:function(){loader()}}).done(function(e){console.log(e),""!==e&&window.location.replace(domain+"/start/"+t)}),!1})})})})):($(".modal-body").html(" <p>Veuillez vous connecter via Facebook pour créer votre propre test !<br>Simple ! Gratuit ! Sécurisé !</p><p style='font-weight:700'> Les autorisations suivantes sont nécessaires pour effectuer  ce test : <br> Liste d'amis, Publications, Photos </p><p style='font-weight:800'> Vous devez accorder les autorisations pour continuer."),$("#div_erreur_aut").fadeIn("slow").css("display","block"),setTimeout(function(){$("#div_erreur_aut").fadeOut()},7e3))}):(console.log(e),FB.api("/me",{locale:"fr_FR",fields:"id,first_name,last_name,gender"},function(e){return $.ajax({url:domain+"/connect_user",type:"POST",data:"id="+e.id+"&prenom="+e.first_name+"&nom="+e.last_name+"&genre="+e.gender,beforeSend:function(){}}).done(function(e){console.log(e),""!==e&&window.location.replace(domain+"/start/"+t)}),!1}))}var task=0;loader=function(){$("#btn-result").prop("disabled",!0),$("#div_test").css("display","none"),$("#div_loader").css("display","block"),$("html, body").animate({scrollTop:0},600),setInterval(function(){task>=tasks.length&&(task=0),$("#div_tasks").html(tasks[task++])},700)},loaderReTest=function(){$("#result_block").css("display","none"),$("#div_loader").css("display","block"),$("html, body").animate({scrollTop:0},600),setInterval(function(){task>=tasks.length&&(task=0),$("#div_tasks").html(tasks[task++])},700)},notLoader=function(){$("#btn-result").html('<i class="fa fa-facebook-square"></i>  Connecte-toi sur Facebook'),$("#div_test").fadeIn("fast"),$("#div_loader").fadeOut("fast")};
